Bắt đầu với bài này thì có dùng dirsearch trước để recon một số thông tin
![image](https://user-images.githubusercontent.com/20487674/129816250-aff319ee-39d9-40b4-8041-b1eeebcd87a7.png)
Sau khi mình truy những đường link trên thì focus vài đường link:
* http://machine3.hacksec.in:8000/console
* ![image](https://user-images.githubusercontent.com/20487674/129909160-3dc9e4c4-818e-4145-bb51-436fafbd5d49.png)
* http://machine3.hacksec.in:8000/docs
* ![image](https://user-images.githubusercontent.com/20487674/129909083-22c88863-1587-4d71-b605-67ac883bda2a.png)
* http://machine3.hacksec.in:8000/server-status
* ![image](https://user-images.githubusercontent.com/20487674/129908997-83cae236-89aa-4aaa-91ad-3688405cd900.png)

* Bắt đầu link http://machine3.hacksec.in:8000/console Werkzeug Debugger được bảo mật bằng mã pin, sau mình lên google tìm có tìm đọc được cách bypass qua được bài viết ở đây https://www.daehee.com/werkzeug-console-pin-exploit/ 
* Về cách bypass thì lợi dụng function  get_pin_and_cookie_name ở __init__.py mọi có thể xem ở đây https://github.com/pallets/werkzeug/blob/main/src/werkzeug/debug/__init__.py
```
def get_pin_and_cookie_name(
    app: "WSGIApplication",
) -> t.Union[t.Tuple[str, str], t.Tuple[None, None]]:
    """Given an application object this returns a semi-stable 9 digit pin
    code and a random key.  The hope is that this is stable between
    restarts to not make debugging particularly frustrating.  If the pin
    was forcefully disabled this returns `None`.
    Second item in the resulting tuple is the cookie name for remembering.
    """
    pin = os.environ.get("WERKZEUG_DEBUG_PIN")
    rv = None
    num = None

    # Pin was explicitly disabled
    if pin == "off":
        return None, None

    # Pin was provided explicitly
    if pin is not None and pin.replace("-", "").isdigit():
        # If there are separators in the pin, return it directly
        if "-" in pin:
            rv = pin
        else:
            num = pin

    modname = getattr(app, "__module__", t.cast(object, app).__class__.__module__)
    username: t.Optional[str]

    try:
        # getuser imports the pwd module, which does not exist in Google
        # App Engine. It may also raise a KeyError if the UID does not
        # have a username, such as in Docker.
        username = getpass.getuser()
    except (ImportError, KeyError):
        username = None

    mod = sys.modules.get(modname)

    # This information only exists to make the cookie unique on the
    # computer, not as a security feature.
    probably_public_bits = [
        username,
        modname,
        getattr(app, "__name__", type(app).__name__),
        getattr(mod, "__file__", None),
    ]

    # This information is here to make it harder for an attacker to
    # guess the cookie name.  They are unlikely to be contained anywhere
    # within the unauthenticated debug page.
    private_bits = [str(uuid.getnode()), get_machine_id()]

    h = hashlib.sha1()
    for bit in chain(probably_public_bits, private_bits):
        if not bit:
            continue
        if isinstance(bit, str):
            bit = bit.encode("utf-8")
        h.update(bit)
    h.update(b"cookiesalt")

    cookie_name = f"__wzd{h.hexdigest()[:20]}"

    # If we need to generate a pin we salt it a bit more so that we don't
    # end up with the same value and generate out 9 digits
    if num is None:
        h.update(b"pinsalt")
        num = f"{int(h.hexdigest(), 16):09d}"[:9]

    # Format the pincode in groups of digits for easier remembering if
    # we don't have a result yet.
    if rv is None:
        for group_size in 5, 4, 3:
            if len(num) % group_size == 0:
                rv = "-".join(
                    num[x : x + group_size].rjust(group_size, "0")
                    for x in range(0, len(num), group_size)
                )
                break
        else:
            rv = num

    return rv, cookie_name
```
* Một số thông tin mà mình cần để gen pin nha
* ![image](https://user-images.githubusercontent.com/20487674/129914065-3328075b-4f70-4c31-bd55-784d7c47d67e.png)
* Bắt đầu focus lại chỗ  này
* ![image](https://user-images.githubusercontent.com/20487674/129914590-540295c6-507c-436a-83c1-5833dc334c5f.png)
* ![image](https://user-images.githubusercontent.com/20487674/129914764-8518d564-aaa3-4358-bd76-a6b35cdfc0e8.png)
* Từ đây có nguy cơ có thể tận dụng đọc file local ,có parameter path 
* http://machine3.hacksec.in:8000/download?path=/etc/os-release
* ![image](https://user-images.githubusercontent.com/20487674/129915440-38640624-ccd6-43fa-8435-c7448c04a2da.png)
* ![image](https://user-images.githubusercontent.com/20487674/129916084-b2139ea8-688c-4a8e-9725-62b1ab9efe8c.png)
* Có khả năng là user hacker là user dùng để deploy flask , mình kiểm tra file /etc/passwd xem: http://machine3.hacksec.in:8000/download?path=/etc/passwd
* ![image](https://user-images.githubusercontent.com/20487674/129916687-806b2860-6218-416a-af82-e43358d076ed.png)
* Có user hacker , tiếp đến mình path lib flask
* ![image](https://user-images.githubusercontent.com/20487674/129916937-7572dd7a-4539-4cd5-b254-05ad9d9148c1.png)

* Tiếp thu mình tìm mac address ,chú đến đoạn này 
* ![image](https://user-images.githubusercontent.com/20487674/129915906-da8f9f33-6d40-4d06-846b-a661719ff365.png)
* Mình sẽ convert mac address sang decimal
* ![image](https://user-images.githubusercontent.com/20487674/129917663-156da12d-6d90-4ae4-83ff-c6ff13d30cf6.png)
* Giống y hệt cái node_uuid, tiếp đến mình tìm số seri thiết bị thông qua /etc/machine-id: http://machine3.hacksec.in:8000/download?path=/etc/machine-id
* ![image](https://user-images.githubusercontent.com/20487674/129918009-c2eddd3a-d44a-4ba5-909a-0315e60c4312.png)
* Chuẩn bị đồ gen pin thui nào
* ![image](https://user-images.githubusercontent.com/20487674/129918573-f490845c-5359-4803-bbc8-4e4192182c1d.png)
* Code exploit mình kham khảo ở link phía trên đầu ấy
* ![image](https://user-images.githubusercontent.com/20487674/129918790-857ab009-0a5f-47ce-818a-c9f975c773b6.png)
* ![image](https://user-images.githubusercontent.com/20487674/129918978-ac6fe869-fde7-4e00-b6f7-e4850f7f8d37.png)
* Ok vô quất tìm flag thui
* ![image](https://user-images.githubusercontent.com/20487674/129919923-41ae1dcd-44b3-4e27-98ec-aae44fe47ca2.png)
* Sau một hồi tìm flag cực khổ :V
* ![image](https://user-images.githubusercontent.com/20487674/129920243-51c89890-b1b8-4a47-ae26-40e2959a8ad3.png)
# Link kham khảo: https://www.daehee.com/werkzeug-console-pin-exploit/
