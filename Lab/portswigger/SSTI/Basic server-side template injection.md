# Lab Basic server-side template injection
* Bắt đầu với lab này thì yêu cầu chúng ta slove bằng cái xóa file morale.txt từ thư mục home Carlos's, và lab này có nhắc đến ERB template(Embedded RuBy)
* Search google coi ERB template là (Embedded RuBy) là cho phép chúng ta nhúng code ruby vào html
* Thẻ <% %> : được sử dụng để thực thi Ruby code mà không trả về bất cứ giá trị nào. Ví dụ như: lệnh điều kiện if else, lệnh lặp loop each for while,..
,Thẻ <%= %>: được sử dụng để chèn một giá trị nào đó mà bạn muốn xuất ra trên View (trích từ link này nha https://nnthao.wordpress.com/2017/08/31/series-huong-dan-lap-trinh-ruby-on-rails-phan-8-cac-ky-thuat-trong-rails-ban-nen-biet2/)
https://www.stuartellis.name/articles/erb/
* ![image](https://user-images.githubusercontent.com/20487674/128272263-83584faf-15d9-42fa-9435-d4a8df3a5fbb.png)
* Mình có thể gọi một hàm trong class nào đó để thực thi: 
* ![image](https://user-images.githubusercontent.com/20487674/128272895-06315e7d-02bd-4e18-a990-703a916c617a.png)
* Sau 1 hồi mình tìm endpoint để inject vào đã đời thì đây
* ![image](https://user-images.githubusercontent.com/20487674/128272992-e67667b1-1c9d-4005-bd19-c529ee6c3b51.png)
* Có thể thấy Time.now đã được thực thi và mình search tiếp coi cách nào có thực thi commandline thì  có một số cách 
* ```system("command")``` sẽ trả về 1 trong 3 giá trị: true(nếu command thực thi thành công kèm theo output command) , false nếu command trả về mã lỗi,nil có nghĩa command thực thi không thành công(command not found)
* ![image](https://user-images.githubusercontent.com/20487674/128274761-5cac5d9a-4f48-42ba-88dd-8720a935517b.png)
* ``` `command` ``` sử dụng backtick shell để thực thi command
* ![image](https://user-images.githubusercontent.com/20487674/128285859-572191bc-ca5a-4cf2-9095-07414d7b2c1d.png)
* ```%x(command)``` sẽ sử dụng backtick shell để thực thi command,note command có thể được bao bọc bởi non-alphanumeric characters và non-printing characters
* ![image](https://user-images.githubusercontent.com/20487674/128274816-87bff258-4087-4d1c-83d3-3dc120e79aee.png)
*  non-alphanumeric characters: ! @ # & ( ) – [ { } ] : ; ', ? / * \` ~ $ ^ + = < > " khoảng trắng
*  ![image](https://user-images.githubusercontent.com/20487674/128274892-a553c9a2-b520-4aec-9ebe-4f2976b463f7.png)
*  non-printing characters
*  ![image](https://user-images.githubusercontent.com/20487674/128274660-2b760a93-395e-493a-a294-b4ccbed79a57.png)
*  ![image](https://user-images.githubusercontent.com/20487674/128274962-0b94051f-b61f-404b-8950-31bd97d45c1b.png)
* ```exec("command")``` để thực thi command lưu ý nếu mình chạy exec mà không có fork thì nó sẽ thực thi trên process hiện tại
* ![image](https://user-images.githubusercontent.com/20487674/128275517-571c8596-8f36-41a3-8e0b-7b4baed8efc8.png)
* ```fork{exec("command")}``` để thực thi command lưu khi dùng fork nó sẽ process khác để dành việc thực thi ,chứ nó không thực thi trong process hiện tại
* ![image](https://user-images.githubusercontent.com/20487674/128275474-989c1a33-a07f-4bbd-a5ef-ab7d134250fa.png)
* Thì đó là cách để thực thi command , xóa file thui nào (khoảng trắng mình thay thế dấu + nha)
* ![image](https://user-images.githubusercontent.com/20487674/128275651-83bc2d7e-d756-4a84-a4a8-afccea157059.png)
# Note SSTI ERB template(Embedded RuBy) <a name="ssti_ruby(template_ERB)">
* > <%= 3+3 %>
* > RCE: ```system("command")``` , ``` `command` ```  ,  ```%x(command)``` ,  ```exec("command")``` , ```fork{exec("command")}```
* Một link kham khảo:
* https://www.stuartellis.name/articles/erb/
* https://www.rubyguides.com/2018/12/ruby-system/
* https://stackoverflow.com/questions/2232/how-to-call-shell-commands-from-ruby
* https://viblo.asia/p/ruby-percent-notation-q-q-w-w-x-r-s-RQqKLz74l7z
* https://web.itu.edu.tr/sgunduz/courses/mikroisl/ascii.html
* https://ruby-doc.org/core-3.0.2/Kernel.html#method-i-60
* https://nnthao.wordpress.com/2017/08/31/series-huong-dan-lap-trinh-ruby-on-rails-phan-8-cac-ky-thuat-trong-rails-ban-nen-biet2/

