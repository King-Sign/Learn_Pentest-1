# Lab Exploiting XXE to perform SSRF attacks
* Bắt đầu với lab thứ 2 thì endpoint cũ như lab thứ 1 là vẫn là stock và cung cấp cho chúng ta url của server ec2: http://169.254.169.254/ ,lab này muốn chúng tận dụng khai thác lỗi hổng
XXE tấn công ssrf lấy được IAM secret key của server ec2
* ![image](https://user-images.githubusercontent.com/20487674/127095389-d105c898-a874-47ea-8553-835b6decdb42.png)
* Ý tưởng cách tấn công
* ![image](https://user-images.githubusercontent.com/20487674/127096339-d01ab9c1-6b68-4764-b11e-3c51119752da.png)
* Bắt request lại xem có như lab thứ 1 không
* ![image](https://user-images.githubusercontent.com/20487674/127096549-07043236-aa23-471b-bd1f-c319c48193e3.png)
* Do chúng ta có thể chỉnh sửa nội dụng của xml gửi đến server xử lý,nên có thể tận dụng External Entity Declaration trong xml dtd đế lấy dữ liệu từ url http://169.254.169.254/ do vậy
chúng ta có kiểm soát được bắt server có thể gửi request đến bất kỳ server khác để lấy dữ liệu về
* ![image](https://user-images.githubusercontent.com/20487674/127096676-28ef1156-7d7f-4a9d-8c60-f5394244b055.png)
* Tiến hành chỉnh sửa nội dụng xml
* ![image](https://user-images.githubusercontent.com/20487674/127097505-c04459d0-a1db-4a0f-88f5-650c55608089.png)
* Trong response thấy "Invalid product ID: latest" này là content file index hay sao ta thử fuzz extesnion index xem như thế nào
* fuzz: index.php,index.jsp,index.aspx,index.asp
* ![image](https://user-images.githubusercontent.com/20487674/127097997-b7ae029d-30fc-411a-84c4-5071b1e1b648.png)
* Kết quả không có gì cả, thử ghép http://169.254.169.254/latest xem như thế nào
* ![image](https://user-images.githubusercontent.com/20487674/127098390-e54572ab-7c5c-4e80-ba84-528f3aa51c55.png)
* Có lẽ latest là tên một folder trong đó có meta-data tiếp tục tìm tiếp 
![image](https://user-images.githubusercontent.com/20487674/127098588-3ed871cc-ba6d-43b1-8ce0-1a3eb4a2d777.png)
* Có được secret key "SecretAccessKey" : "xC3SMqVyf6ZtCURhmtEu2jsQOoIG0VrlVJY6tX9M" và slove
* ![image](https://user-images.githubusercontent.com/20487674/127098693-30cf8d45-5088-408a-8fad-40ef471a81ff.png)


