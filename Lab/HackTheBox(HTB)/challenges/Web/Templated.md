# Templated
* Bắt đầu thui , vô ngay trước mặt là chúng ta
* ![image](https://user-images.githubusercontent.com/20487674/127171582-07fed223-4dcc-4be6-ad94-25e92217952d.png)
* Focus lại chỗ Flask/Jinja2 thường mình sẽ nghĩ ngay đến SSTI(server-side template injection) có RCE được, thường thì flask thường được sử dụng làm web api gọi parameter thông qua url
* Cách fuzz ssti
* ![image](https://user-images.githubusercontent.com/20487674/127172525-de6312ff-80fd-4d36-b157-936ffb001536.png)
* Thử test {{5+6}} xem như thế nào
* ![image](https://user-images.githubusercontent.com/20487674/127173147-51e42f74-0e82-4725-93ef-b50dfba9ef4d.png)
* Vậy là xác định dính vuln rùi, thường thì Jinja2 nếu test {{3*'1'}} sẽ in ra kết quả 3 số 1 và đối với Twig thì kết quả là 3 (đọc tài liệu bên portswigger)
![image](https://user-images.githubusercontent.com/20487674/127173672-c6f553c6-b451-45b8-bf50-87fca89f346d.png)
* Mình sẽ sử dụng một số Special Attributes trong python
* > {{''\.\_\_class__}} , object\.\_\_class__ trả Tên của lớp mà đối tượng thuộc về
* ![image](https://user-images.githubusercontent.com/20487674/127174508-831500a5-73d2-42f4-b598-88fd60eeeeee.png)
* > {{''\.\_\_class__\.\_\_bases__}} , \_\_bases__ trả về 1 mảng có tất cả các lớp cơ sở mà lớp đó kế thừa.
* ![image](https://user-images.githubusercontent.com/20487674/127175019-5aac7d04-989f-4c5c-8881-e2c6b9fed01e.png)
* > {{''\.\_\_class__\.\_\_bases__[0]\.\_\_subclasses__()}} , \_\_bases__[0] có nghĩa chọn '<class 'object'>' , \_\_subclasses__() trả danh sách các lớp con đang kế thừa nó
* ![image](https://user-images.githubusercontent.com/20487674/127176068-ae31d998-27bd-4fcc-a1fe-5601e0603a30.png)
* Trong những danh sách class mà nó trả về mọi người chỉ cần focus chỗ subprocess module này cho phép mình thực thi commandlline
* ![image](https://user-images.githubusercontent.com/20487674/127176447-321367b1-4642-4f05-a45d-2eb73b6cc8f7.png)
* Tiếp theo viết script nhỏ xác định vị trí subprocess.Popen trong mảng 
* ![image](https://user-images.githubusercontent.com/20487674/127185456-1f52eb1a-3730-4092-a08c-fb390ebc858b.png)
* ![image](https://user-images.githubusercontent.com/20487674/127185668-1cfda94f-8a99-41e5-b511-6e095ecc7b71.png)
* Tìm flag thui 
* ![image](https://user-images.githubusercontent.com/20487674/127186076-5f80e11f-c206-4b16-b146-dbf19aa26a06.png)
![image](https://user-images.githubusercontent.com/20487674/127186144-a8abbb67-bf91-4467-b61f-b92437822141.png)
![image](https://user-images.githubusercontent.com/20487674/127186451-b3175de2-e4b5-4b5b-b0e6-d3dc265a0851.png)
* Môt số link mọi người có thể kham thảo một số payload khác<br>
* https://pequalsnp-team.github.io/cheatsheet/flask-jinja2-ssti
* https://docs.python.org/release/2.6.4/library/stdtypes.html#class.__subclasses__
* https://www.programmersought.com/article/67745990262/
* https://www.frees3c.co.uk/Write-ups/htb/web/templated.html
* https://souvikinator.netlify.app/blog/htb-web-l2/
* https://portswigger.net/research/server-side-template-injection
* https://isopach.dev/DCTF-2021/
* https://twitter.com/secgus/status/1249445491710013450
* https://lx1.medium.com/templated-htb-66262a47545f
